{% extends 'base.html' %}
	
{% load static %}
{% block content %}


<style>
    .table-shopping-cart .column-4{
        text-align: left;
    }
    .accordion {
  max-width: 600px;
  margin: 0 auto;
}

.accordion {
  border: 1px solid #ccc;
  border-radius: 4px;
}

.accordion-item {
  border-top: 1px solid #ccc;
}

.accordion-header {
  background-color: #f1f1f1;
  padding: 10px;
  cursor: pointer;
}

.accordion-content {
  padding: 10px;
  display: none;
}


      
      
</style>
<div class="extraspace" style="height: 60px;"></div>
	<!-- Cart -->
	<div class="wrap-header-cart js-panel-cart">
		<div class="s-full js-hide-cart"></div>

		<div class="header-cart flex-col-l p-l-65 p-r-25">
			<div class="header-cart-title flex-w flex-sb-m p-b-8">
				<span class="mtext-103 cl2">
					Your Cart
				</span>

				<div class="fs-35 lh-10 cl2 p-lr-5 pointer hov-cl1 trans-04 js-hide-cart">
					<i class="zmdi zmdi-close"></i>
				</div>
			</div>
			
			<div class="header-cart-content flex-w js-pscroll">
				<ul class="header-cart-wrapitem w-full">
					<li class="header-cart-item flex-w flex-t m-b-12">
						<div class="header-cart-item-img">
							<img src="images/item-cart-01.jpg" alt="IMG">
						</div>

						<div class="header-cart-item-txt p-t-8">
							<a href="#" class="header-cart-item-name m-b-18 hov-cl1 trans-04">
								White Shirt Pleat
							</a>

							<span class="header-cart-item-info">
								1 x $19.00
							</span>
						</div>
					</li>

					<li class="header-cart-item flex-w flex-t m-b-12">
						<div class="header-cart-item-img">
							<img src="images/item-cart-02.jpg" alt="IMG">
						</div>

						<div class="header-cart-item-txt p-t-8">
							<a href="#" class="header-cart-item-name m-b-18 hov-cl1 trans-04">
								Converse All Star
							</a>

							<span class="header-cart-item-info">
								1 x $39.00
							</span>
						</div>
					</li>

					<li class="header-cart-item flex-w flex-t m-b-12">
						<div class="header-cart-item-img">
							<img src="images/item-cart-03.jpg" alt="IMG">
						</div>

						<div class="header-cart-item-txt p-t-8">
							<a href="#" class="header-cart-item-name m-b-18 hov-cl1 trans-04">
								Nixon Porter Leather
							</a>

							<span class="header-cart-item-info">
								1 x $17.00
							</span>
						</div>
					</li>
				</ul>
				
				<div class="w-full">
					<div class="header-cart-total w-full p-tb-40">
						Total: $75.00
					</div>

					<div class="header-cart-buttons flex-w w-full">
						<a href="shoping-cart.html" class="flex-c-m stext-101 cl0 size-107 bg3 bor2 hov-btn3 p-lr-15 trans-04 m-r-8 m-b-10">
							View Cart
						</a>

						<a href="shoping-cart.html" class="flex-c-m stext-101 cl0 size-107 bg3 bor2 hov-btn3 p-lr-15 trans-04 m-b-10">
							Check Out
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>


	<!-- breadcrumb -->
	<div class="container">
		<div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
			<a href="index.html" class="stext-109 cl8 hov-cl1 trans-04">
			</a>


			<span class="stext-109 cl4">
                
			</span>
		</div>
	</div>
		
	
	<!-- Shoping Cart -->
    
	<!-- <form class="bg0 p-t-75 p-b-85"> -->
        <div class="bg0 p-t-75 p-b-85">
          
            <div class="container-fluid">
                {% if not cart_items %}
                    <h2 class="text-center"> Thank you, Your order has been successfully placed</h2>
                    <br>
                    <br>
                    <div class="text-center">
                        <a href="{% url 'store' %}" class="btn btn-primary">Continue Shopping</a>
                    </div>
                    {% else %}
        <div class="row">
            <div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
                <div class="m-l-25 m-r--38 m-lr-0-xl">
                    <div class="wrap-table-shopping-cart">
                        <table class="table-shopping-cart">
                            <tr class="table_head">
                                <th class="column-1">Product</th>
                                <th class="column-2"></th>
                                <th class="column-3">Price</th>
                                <th class="column-4">Quantity</th>
                                <th class="column-5">Total</th>
                                
                            </tr>

                            {% for cart_item in cart_items %}	
                            <tr class="table_row">
                                <td class="column-1">
                                    <a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}"><div class="how-itemcart1">
                                        <img src="{{cart_item.product.images.url}}" alt="IMG">
                                    </div></a>
                                </td>
                                <td class="column-2"><a href="{{ cart_item.product.get_url }}">{{ cart_item.product.product_name }}</a>
                                <p class="text-muted small">
                                    
                                    {% if cart_item.variations.all %}
                                        
                                        {% for item in cart_item.variations.all %}
                                            {{ item.variation_category | capfirst }} : {{ item.variation_value | capfirst }} <br>
                                            

                                        {% endfor %}
                            
                                    {% endif %}
                                        
                                </p> </td>
                                <td class="column-3">$ {{ cart_item.product.price }}</td>
                                <td class="column-4">
                                    <!-- <div class="wrap-num-product flex-w m-l-auto m-r-0">
                                        <a href="{% url 'remove_cart' cart_item.product.id cart_item.id %}" class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m">
                                            <i class="fs-16 zmdi zmdi-minus"></i>
                                        </a> -->

                                        <input class="mtext-104 cl3 txt-center num-product" type="number" name="quantity" value="{{ cart_item.quantity}}">

                                        
                                        {% comment %} <div class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m">
                                            <form action="{% url 'add_cart' cart_item.product.id %}" method="post">
                                                {% csrf_token %}
                                                
                                                {% for item in cart_item.variations.all %}
                                                    
                                            <input type="hidden" name="{{ item.variation_category | lower }}" value="{{ item.variation_value | capfirst }}">
                                            {% endfor %}
                                            
                                            <a href="{% url 'add_cart' cart_item.product.id %}"> <button class="fs-16 zmdi zmdi-plus" type="submit"></i></button> 
                                            </a>
                                        
                                    </form>
                                    </div> {% endcomment %}
                                </td>
                                <td id="subtotal{{cart_item.product.id}}" class="column-5">$ {{ cart_item.sub_total }}</td>

                            </tr>
                            {% endfor %}
                        </table>
                    </div>

                    <div class="flex-w flex-sb-m bor15 p-t-18 p-b-15 p-lr-40 p-lr-15-sm">
                        

                      
                    </div>
                    <!-- Add Address Button -->
<!-- Add Address Button -->



  
  <!-- Address Cards -->
  
  
 
      
  <form action="{% url 'placeorder' %}" method="post">
    {% csrf_token %}

  <div class="row" id="addressCards"></div>
        <div class="col-md-14 mb-3 mt-3">
          <div class="card mt-0">
            <div class="card-body">
              <div class="form-check">
                <h4>Address</h4>
                <span class="text-uppercase" style="font-weight: bold;"> {{i.first_name}} {{i.last_name}}</span>
               
             
                <label class="form-check-label" for="addressRadio${addressCount}">
              
                  {{order.address.email}}<br>
                  {{order.address.phone}}<br>
                  {{order.address.address}}<br>
                  {{order.address.pincode}}<br>
                  {{order.address.city}}<br>
                  {{order.address.state}}<br>
                  {{order.address.country}}
                  {{order.address.ordernote}}
                </label>
              </div>
            </div>
          </div>
        </div>
    
        
        
        
       
          </div>
          

      </div>

          
{% comment %} <script>
    function deleteAddress(addressIndex) {
  // Display a confirmation popup
  Swal.fire({
    title: 'Delete Address',
    text: 'Are you sure you want to delete this address?',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'Delete',
    cancelButtonText: 'Cancel'
  }).then((result) => {
    // If the user confirms the deletion
    if (result.isConfirmed) {
      // Remove the address card with the given index
      const addressCard = document.getElementById(`addressRadio${addressIndex}`).parentNode.parentNode.parentNode;
      addressCard.remove();
      
      // Show a success message
      Swal.fire('Deleted!', 'The address has been deleted.', 'success');
    }
  });
}

  </script>
   {% endcomment %}


                
            
            <div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
                <div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
                    <h4 class="mtext-109 cl2 p-b-30">
                        Cart Totals
                    </h4>

                    <div class="flex-w flex-t bor12 p-b-13">
                        <div class="size-208">
                            <span class="stext-110 cl2">
                                Subtotal: $ {{total}}
                            </span>
                        </div>
                       
                          <div class="checkout__order__total" id="coupon_block" style="display: none;">
                              Discount <span>- ₹<b id="coupon_discount"></b></span>
                              <h1 class="text-danger" style="font-size: 12px;">*Coupon Applied - <b id="coupon_code"></b></h1>
                          </div>
                    

                        <div class="size-209">
                          <input type="text" name="coupon" id="coupon_code1" style="display: none;">
                          <span id='grand_total' class="mtext-110 cl2">
                                ${{grand_total}}
                              </span>
                        </div>
                    </div>


                    <div class="flex-w flex-t bor12 p-t-15 p-b-30">
                        <div class="size-208 w-full-ssm">
                            <span class="stext-110 cl2">
                                Payment Method:
                            </span>
                        </div>

                        <div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
                            <p class="stext-111 cl6 p-t-2">
                                There are many payment methods available. Please double check your address, or contact us if you need any help.
                            </p>
                            
                            <div class="p-t-15">
                                <span class="stext-112 cl8">
                                    Calculate Amount
                                </span>
                                
                                <div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">
                                    <select class="js-select2" name="payment_method">
                                        <option>Select a payment method...</option>
                                        <option value="cash_on_delivery" selected>Cash on delivery</option>
                                        <option value="paytm">Paytm</option>
                                    </select>
                                    <div class="dropDownSelect2"></div>
                                </div>

                                <div class=" bg0 m-b-12">
                                    <!-- <input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="state" placeholder="State /  country"> -->
                                </div>

                                <div class=" bg0 m-b-22">
                                    <!-- <input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="postcode" placeholder="Postcode / Zip"> -->
                                </div>
                                
                                <div class="flex-w">
                                    <div class="flex-c-m stext-101 cl2 size-115 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer">
                                        Update Totals
                                    </div>
                                    
                                </div>
                                    
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex-w flex-t p-t-27 p-b-33">
                        <div class="size-208">
                            <span class="mtext-101 cl2">
                                Total:
                            </span>
                        </div>
                        
                        <div class="size-209 p-t-1">
                          <input type="text" name="coupon" id="coupon_code2" style="display: none;">
                          <span id='grand_tota2' class="mtext-110 cl2">
                                ${{grand_total}}
                              </span>
                        </div>
                    </div>
                    
                    <button class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer" type="submit">
                        Proceed to Checkout
                    </button>
                    <button type="button"  class="btn_3 mt-3 payWithRazorpay " href="#">Pay with Razorpay</button>
                </form>
                </div>
            </div>
        </div>
        {% endif %}
    </form>  
    </div>
</div>


    <!-- Checkout End -->
</section>

  <!--================End Checkout Area =================-->
  {% comment %} {% include 'includes/footer.html' %}
{% endblock %}
{% block bottomlink %} {% endcomment %}
  <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    $(document).ready(function () {

      $('.payWithRazorpay').click(function (e) {
        e.preventDefault();

        var fname = $("[name='fname']").val()
        var lname = $("[name='lname']").val()
        var phone = $("[name='phone']").val()
        var email = $("[name='email']").val()
        var city = $("[name='city']").val()
        var state = $("[name='state']").val()
        var country = $("[name='country']").val()
        var pincode = $("[name='pincode']").val()
        var district = $("[name='district']").val()
        var address = $("[name='address']").val()
        var token = $("[name='csrfmiddlewaretoken']").val()

        if(fname == "" || lname == "" || phone == "" || email == "" || city == "" || state == "" || country == "" || pincode == "" || district == "" || address == "")
        {
          swal("Alert!", "All fields are mandatory!", "error");

        }


          $.ajax({
             method:"GET",
             url:"/order/checkout/proceed-to-pay/",
             success: function(response) {

              var options = {
                "key": "rzp_test_IAsoLLg94jUgWM", // Enter the Key ID generated from the Dashboard
                "amount": 1*100,//response.total_price * 100, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                "currency": "INR",
                "name": "LapKart",
                "description": "Thank you for buying with us",
                "image": "https://example.com/your_logo",
                //"order_id": "order_IluGWxBm9U8zJ8", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                "handler": function (responseb){
                    data = {
                      'address_id' :' {{order.address.id}}',
                      csrfmiddlewaretoken : token

                    }
                      $.ajax({
                        method:"POST",
                        url:"/order/razorpay-placeorder/",
                        data: data,
                        success: function (responsec) {
                          console.log(responsec)
                          swal("Congratulations!", responsec.status,"success").then((value) => {
                              window.location.href = '/myorders/'
                          });
                        }

                    });
                },
                "prefill": {
                    "name": fname+" "+lname,
                    "email": email,
                    "contact": phone
                },
                
                "theme": {
                    "color": "#3399cc"
                }
            };
            var rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response){
                    alert(response.error.code);
                    alert(response.error.description);
                    alert(response.error.source);
                    alert(response.error.step);
                    alert(response.error.reason);
                    alert(response.error.metadata.order_id);
                    alert(response.error.metadata.payment_id);
            });
            rzp1.open();
              console.log(responsec);

             }
          });
          
   
        





        
      });

    });
    
    </script>
  <script src="{% static 'assetUser/js/jquery.nice-select.min.js' %}"></script>

  <script src="{% static 'assetUser/js/stellar.js' %}"></script>
  <script src="{% static 'assetUser/js/price_rangs.js' %}"></script>




<div style="height: 80px;"></div>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
    integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
    $('#coupon_form').on('submit', function (e) {

        e.preventDefault();
        console.log('function calling..... coupon')
        $.ajax({
            type: "POST",
            url: "{% url 'coupons' %}",
            data: {
                coupon: $('#coupon_data').val(),
                grand_total: '{{grand_total}}',
                csrfmiddlewaretoken: '{{ csrf_token }}',
                dataType: "json",

            },

            success: function (data) {
                $('#output').html(data.msg) /* response message */
                $('#grand_total').text('₹' + data.grand_total)
                $('#grand_tota2').text('₹' + data.grand_total)
                if (data.coupon_discount > 0) {
                    $('#coupon_block').show()
                    $('#accordionExample').hide()
                }
                $('#coupon_discount').html(data.coupon_discount)
                $('#coupon_code').html(data.coupon_code)
                $('#coupon_code1').val(data.coupon_code)
                $('#coupon_code2').val(data.coupon_code)


            },

            failure: function () {

            }


        });


    });  

    // Get all accordion headers
var accordionHeaders = document.getElementsByClassName("accordion-header");

// Add click event listener to each accordion header
for (var i = 0; i < accordionHeaders.length; i++) {
  accordionHeaders[i].addEventListener("click", function() {
    // Toggle the display of the accordion content
    this.nextElementSibling.style.display = (this.nextElementSibling.style.display === "block") ? "none" : "block";
  });
}

</script>
{% endblock %}	

